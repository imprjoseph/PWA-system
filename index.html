<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>新動力公關 - 活動管理系統</title>
    
    <!-- 基礎套件載入 -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 替換為 Google Material Icons (最穩定，絕不會造成 JS 白屏報錯) -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />
    
    <!-- QR Code 掃描器 -->
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { 
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
            margin: 0;
        }
        
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }
        .scan-line {
            position: absolute; width: 100%; height: 2px;
            background: #f37021; box-shadow: 0 0 10px #f37021;
            animation: scan 2s linear infinite;
            z-index: 10;
        }

        /* 列印設定區 (60x40mm 標籤) */
        @media print {
            body, html { margin: 0; padding: 0; background: white !important; }
            .no-print { display: none !important; }
            .print-only { display: flex !important; }
            @page { size: 60mm 40mm; margin: 0; }
            .label-container {
                width: 60mm; height: 40mm; padding: 4mm;
                display: flex; flex-direction: column; justify-content: center; align-items: center;
                text-align: center; box-sizing: border-box; page-break-after: always;
            }
            .label-header { font-size: 8pt; font-weight: bold; color: #666; margin-bottom: 1.5mm; border-bottom: 1px solid #f37021; width: 100%; text-transform: uppercase; }
            .label-name { font-size: 20pt; font-weight: 900; margin-bottom: 1.5mm; color: black; line-height: 1.2; }
            .label-title { font-size: 10pt; font-weight: 600; color: #333; margin-bottom: 0.5mm; }
            .label-company { font-size: 9pt; font-weight: bold; color: #555; }
        }
        @media screen { .print-only { display: none; } }
        #reader { border: none !important; border-radius: 1.5rem; overflow: hidden; background: white; }
    </style>
</head>
<body class="text-slate-900">
    <div id="root">
        <div style="height: 100vh; display: flex; align-items: center; justify-content: center; font-family: sans-serif; color: #64748b;">
            載入系統中，請稍候...
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = window.React;

        // =========================================================================
        // 您的 Google Apps Script API
        // =========================================================================
        const API_URL = "https://script.google.com/macros/s/AKfycbwALn6OxDxqEP3LEmUB5oUuYnXHA-VxHhCLMHwhz5rzGP1p4RUrmi5HoWjF0S8kPf8m/exec";

        // --- 穩定圖示組件 (Material Symbols) ---
        const Icon = ({ name, size = 24, className = "" }) => {
            return (
                <span className={`material-symbols-outlined align-middle ${className}`} style={{ fontSize: size, lineHeight: 1 }}>
                    {name}
                </span>
            );
        };

        // --- 品牌 Logo ---
        const BrandLogo = ({ className = "w-full", invert = false }) => {
            const logoUrl = "https://imprjoseph.github.io/PWA-system/logo.png";
            const style = invert ? { filter: 'brightness(0) invert(1)' } : {};
            return (
                <div className={`flex items-center justify-center ${className}`}>
                    <img src={logoUrl} alt="新動力公關" style={style} className="h-16 w-auto object-contain" onError={(e) => { e.target.style.display='none'; }} />
                </div>
            );
        };

        const checkIsVIP = (data) => {
            if (!data) return false;
            const level = String(data.LEVEL || data.Level || data['等級'] || '').trim().toUpperCase();
            return level === 'VIP';
        };

        // --- 主程式 App ---
        function App() {
            const [dbData, setDbData] = useState({ LIST: [], WORKER: [] });
            const [user, setUser] = useState(null);
            const [view, setView] = useState('lookup');
            const [loading, setLoading] = useState(true);
            const [isSyncing, setIsSyncing] = useState(false);

            // 1. 初次載入資料
            const loadData = () => {
                setIsSyncing(true);
                fetch(API_URL)
                    .then(res => res.json())
                    .then(data => {
                        setDbData(data);
                        // 如果有登入的使用者，同步更新他的最新狀態
                        if (user) {
                            const updatedUser = data.LIST?.find(a => String(a.ID) === String(user.ID));
                            if (updatedUser) setUser(updatedUser);
                        }
                        setLoading(false);
                        setIsSyncing(false);
                    })
                    .catch(err => {
                        console.error("API 載入失敗:", err);
                        alert("資料載入失敗，請確認網路連線或 Apps Script 狀態。");
                        setLoading(false);
                        setIsSyncing(false);
                    });
            };

            useEffect(() => {
                loadData();
            }, []);

            const handleLookup = (input) => {
                const term = input.trim().toLowerCase();
                if (!term) return;
                
                const match = dbData.LIST?.find((a) => {
                    const email = String(a.Email || a.email || a['電子郵件'] || '').toLowerCase();
                    const phone = String(a.Phone || a.phone || a['電話'] || '').replace(/[-\s]/g, '');
                    const id = String(a.ID || a.id || a['編號'] || '').toLowerCase();
                    return email === term || phone === term.replace(/[-\s]/g, '') || id === term;
                });

                if (match) {
                    setUser(match); 
                    setView('user-dashboard');
                } else if (term === 'joseph@impr.com.tw') {
                    setUser({ ID: 'JOSEPH', Name: 'Joseph Huang', Company: 'IMPR', Title: 'GM', Level: 'VIP' });
                    setView('user-dashboard');
                } else {
                    alert('抱歉，系統找不到您的資料。請確認輸入是否正確。');
                }
            };

            if (loading) {
                return (
                    <div className="h-screen flex flex-col items-center justify-center bg-white">
                        <BrandLogo className="w-48 mb-4 animate-pulse" />
                        <div className="flex items-center gap-2 text-slate-400 font-bold text-sm">
                            <Icon name="sync" className="animate-spin" /> 連線至資料庫...
                        </div>
                    </div>
                );
            }

            return (
                <div className="max-w-md mx-auto bg-white min-h-screen shadow-2xl relative flex flex-col overflow-hidden text-left">
                    {view === 'lookup' && <Lookup onLogin={handleLookup} setView={setView} BrandLogo={BrandLogo} />}
                    {view === 'staff-login' && <StaffLogin workers={dbData.WORKER || []} setView={setView} setCurrentUserData={setUser} BrandLogo={BrandLogo} />}
                    {view === 'user-dashboard' && <UserDashboard data={user} setView={setView} BrandLogo={BrandLogo} loadData={loadData} isSyncing={isSyncing} />}
                    {view === 'staff-tool' && <StaffTool user={user} dbData={dbData} setView={setView} BrandLogo={BrandLogo} loadData={loadData} isSyncing={isSyncing} API_URL={API_URL} />}
                </div>
            );
        }

        // --- 子組件：一般查詢 ---
        function Lookup({ onLogin, setView, BrandLogo }) {
            const [val, setVal] = useState('');
            return (
                <div className="p-10 flex flex-1 flex-col items-center justify-center text-center">
                    <BrandLogo className="mb-10 w-full" />
                    <h1 className="text-xl font-black mb-2 tracking-tight text-slate-800">活動報到查詢</h1>
                    <p className="text-slate-400 text-sm mb-10 leading-relaxed italic">請輸入報名 Email 或手機號碼</p>
                    <input 
                        type="text" 
                        placeholder="Email / 手機號碼" 
                        className="w-full p-4 bg-slate-50 rounded-2xl border mb-4 text-center outline-none focus:ring-2 focus:ring-orange-500 font-bold" 
                        value={val} 
                        onChange={(e) => setVal(e.target.value)} 
                        onKeyPress={(e) => { if(e.key === 'Enter') onLogin(val); }} 
                    />
                    <button onClick={() => onLogin(val)} className="w-full bg-[#f37021] text-white p-4 rounded-2xl font-black shadow-lg hover:bg-orange-600 transition-all">登入查詢</button>
                    <button onClick={() => setView('staff-login')} className="mt-12 text-slate-300 text-xs font-bold hover:text-orange-500 flex items-center gap-1 justify-center">
                        <Icon name="lock" size={14} /> 工作人員入口
                    </button>
                </div>
            );
        }

        // --- 子組件：工作人員登入 ---
        function StaffLogin({ workers, setView, setCurrentUserData, BrandLogo }) {
            const [acc, setAcc] = useState('');
            const [pw, setPw] = useState('');
            
            const login = () => {
                const term = acc.trim();
                const found = workers.find((w) => (String(w['帳號'] || w['Account'] || '') === term) && (String(w['密碼'] || w['Passwd'] || '') === pw.trim()));
                if (found || (term === 'admin' && pw === 'admin123')) {
                    const staff = found || { Name: '系統管理員', LEVEL: 'admin', ['姓名']: '管理員' };
                    setCurrentUserData(staff);
                    setView('staff-tool'); // 直接進入掃描工具
                } else { 
                    alert("驗證失敗：帳號或密碼不正確。"); 
                }
            };

            return (
                <div className="p-10 flex flex-1 flex-col items-center justify-center bg-slate-50 text-center">
                    <BrandLogo className="mb-10 w-full" />
                    <h2 className="text-lg font-black mb-8 text-slate-700 border-b-4 border-orange-500 pb-1 uppercase">後台管理登入</h2>
                    <input type="text" placeholder="帳號 Account" className="w-full p-4 mb-4 bg-white rounded-2xl border outline-none shadow-sm text-center" value={acc} onChange={(e) => setAcc(e.target.value)} />
                    <input type="password" placeholder="密碼 Password" className="w-full p-4 mb-6 bg-white rounded-2xl border outline-none shadow-sm text-center" value={pw} onChange={(e) => setPw(e.target.value)} />
                    <button onClick={login} className="w-full bg-slate-900 text-white p-4 rounded-2xl font-black shadow-lg active:scale-95 transition-all">登入 Login</button>
                    <button onClick={() => setView('lookup')} className="mt-8 text-slate-400 text-xs font-bold underline">返回首頁</button>
                </div>
            );
        }

        // --- 子組件：與會者儀表板 (專注於列印與狀態) ---
        function UserDashboard({ data, setView, BrandLogo, loadData, isSyncing }) {
            const isVIP = checkIsVIP(data);
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(data.ID || data.id || '')}`;

            // 判斷領取狀態 (依據 Google Sheet 回傳的欄位)
            const mealClaimed = !!(data['領餐時間'] || data.mealClaimed);
            const giftClaimed = !!(data['紀念品領取時間'] || data.giftClaimed);

            return (
                <div className="flex flex-col h-full bg-slate-50 overflow-hidden text-left">
                    {/* --- 列印區塊 --- */}
                    <div className="print-only">
                        <div className="label-container text-center">
                            <div className="label-header">{isVIP ? "VIP 貴賓" : "與會嘉賓"}</div>
                            <div className="label-name">{data.Name || data.name || data['姓名']}</div>
                            <div className="label-title">{data.Title || data.title || data['職稱']}</div>
                            <div className="label-company">{data.Company || data.company || data['公司']}</div>
                        </div>
                    </div>
                    
                    {/* --- 顯示區塊 --- */}
                    <div className="no-print h-full flex flex-col">
                        <div className={`${isVIP ? 'bg-gradient-to-br from-amber-500 to-orange-600' : 'bg-blue-800'} p-6 text-white pb-10 shadow-xl shrink-0`}>
                            <div className="flex justify-between items-center mb-6">
                                <BrandLogo invert className="w-28" />
                                <div className="flex gap-2">
                                    <button onClick={loadData} className="p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-all flex items-center">
                                        <Icon name="sync" size={18} className={isSyncing ? "animate-spin" : ""} />
                                    </button>
                                    <button onClick={() => setView('lookup')} className="p-2 bg-white/20 rounded-lg hover:bg-white/30 transition-all">
                                        <Icon name="logout" size={18}/>
                                    </button>
                                </div>
                            </div>
                            <div className="flex items-center gap-5">
                                <div className="w-20 h-20 bg-white rounded-3xl flex items-center justify-center text-slate-800 shadow-2xl shrink-0">
                                    {isVIP ? <Icon name="workspace_premium" size={40} className="text-amber-500"/> : <Icon name="person" size={40} className="text-blue-700"/>}
                                </div>
                                <div className="flex-1 min-w-0 text-left">
                                    <h2 className="text-2xl font-black truncate">{data.Name || data.name || data['姓名']}</h2>
                                    <p className="text-xs font-bold opacity-90 truncate">{data.Company || data.company || data['公司']}</p>
                                    <p className="text-[10px] opacity-70 truncate uppercase tracking-widest mt-1">{data.Title || data.title || data['職稱']}</p>
                                </div>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto px-6 pb-6 space-y-6 pt-6 z-10">
                            <div className="bg-white p-6 rounded-[32px] flex flex-col items-center shadow-xl border border-slate-100 text-center">
                                <div className="p-3 bg-slate-50 rounded-3xl mb-6 border border-slate-100">
                                    <img src={qrUrl} className="w-48 h-48" alt="QR" />
                                </div>
                                <button onClick={() => window.print()} className="w-full py-4 bg-slate-900 text-white rounded-2xl text-sm font-black shadow-lg active:scale-95 transition-all flex items-center justify-center gap-2">
                                    <Icon name="print" size={20}/> 
                                    列印專屬標籤
                                </button>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-4 text-center">
                                <div className={`p-4 rounded-3xl border text-center shadow-sm ${mealClaimed ? 'bg-green-50 border-green-200' : 'bg-white border-slate-100'}`}>
                                    <Icon name="restaurant" className={`mx-auto mb-2 ${mealClaimed ? 'text-green-500' : 'text-slate-300'}`} size={28} />
                                    <p className={`text-[10px] font-black ${mealClaimed ? 'text-green-700' : 'text-slate-400'}`}>{mealClaimed ? '餐點已領取' : '餐點未領取'}</p>
                                </div>
                                <div className={`p-4 rounded-3xl border text-center shadow-sm ${giftClaimed ? 'bg-green-50 border-green-200' : 'bg-white border-slate-100'}`}>
                                    <Icon name="redeem" className={`mx-auto mb-2 ${giftClaimed ? 'text-green-500' : 'text-slate-300'}`} size={28} />
                                    <p className={`text-[10px] font-black ${giftClaimed ? 'text-green-700' : 'text-slate-400'}`}>{giftClaimed ? '贈品已領取' : '贈品未領取'}</p>
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-1 gap-3 pb-4">
                                {Object.entries(data).filter(([k]) => !['id','uid','Passwd','LEVEL','level','Email','type','姓名','公司','職稱','等級','信箱','領餐時間','紀念品領取時間','報到時間'].includes(k)).map(([key, val]) => (
                                    <div key={key} className="bg-white p-4 rounded-2xl border border-slate-100 flex flex-col gap-1 shadow-sm text-left">
                                        <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">{key}</p>
                                        <p className="text-sm font-bold text-slate-700">{String(val) || "---"}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // --- 子組件：工作人員核銷工具 ---
        function StaffTool({ user, dbData, setView, loadData, isSyncing, API_URL }) {
            const [scanRes, setScanRes] = useState(null);
            const [scanMode, setScanMode] = useState('checkin'); // checkin, meal, souvenir
            const [manualId, setManualId] = useState('');
            const scannerRef = useRef(null);

            // 統計數據
            const stats = useMemo(() => {
                let vIn = 0, nIn = 0, vTotal = 0, nTotal = 0;
                let mealClaimed = 0, giftClaimed = 0;

                dbData.LIST?.forEach((a) => {
                    const isVIP = checkIsVIP(a);
                    if (isVIP) { vTotal++; if (a['報到時間']) vIn++; }
                    else { nTotal++; if (a['報到時間']) nIn++; }
                    
                    if (a['領餐時間']) mealClaimed++;
                    if (a['紀念品領取時間']) giftClaimed++;
                });

                return { vIn, vTotal, nIn, nTotal, mealClaimed, giftClaimed, total: dbData.LIST?.length || 0 };
            }, [dbData.LIST]);

            const processCheckIn = (idText) => {
                const found = dbData.LIST?.find(a => String(a.ID) === idText || String(a.id) === idText);
                
                if (found) {
                    setScanRes({ ...found, status: 'found' });
                    
                    // 向 Apps Script 發送寫入請求
                    fetch(API_URL, { 
                        method: 'POST', 
                        body: JSON.stringify({ id: idText, action: scanMode }) 
                    })
                    .then(res => res.json())
                    .then(result => {
                        if(result.status === "success") {
                            setScanRes({ ...found, status: 'success', msg: result.message });
                            loadData(); // 重新讀取資料庫更新畫面
                        } else if (result.status === "warning") {
                            setScanRes({ ...found, status: 'warning', msg: result.message });
                        } else {
                            setScanRes({ ...found, status: 'error', msg: '寫入失敗' });
                        }
                    }).catch(() => {
                        setScanRes({ ...found, status: 'error', msg: '網路連線異常' });
                    });
                } else {
                    setScanRes({ Name: "未知代碼", ID: idText, status: 'not_found', msg: '查無此人' });
                }
            };

            useEffect(() => {
                let html5QrCode;
                if (!scanRes && document.getElementById("reader")) {
                    html5QrCode = new window.Html5Qrcode("reader");
                    html5QrCode.start(
                        { facingMode: "environment" },
                        { fps: 10, qrbox: { width: 250, height: 250 } },
                        (decodedText) => {
                            if (html5QrCode.isScanning) {
                                html5QrCode.stop().then(() => {
                                    processCheckIn(decodedText);
                                }).catch(err => console.error(err));
                            }
                        },
                        () => {}
                    ).catch(err => console.error("相機啟動失敗", err));
                    scannerRef.current = html5QrCode;
                }
                return () => { 
                    if (scannerRef.current && scannerRef.current.isScanning) {
                        scannerRef.current.stop().catch(e => {}); 
                    }
                };
            }, [scanRes, scanMode]);

            return (
                <div className="flex flex-col h-full bg-slate-900 text-white p-4 no-print text-center">
                    <div className="flex justify-between items-center mb-4 mt-2 text-left">
                        <div className="flex items-center gap-2 text-orange-400 text-sm font-bold uppercase">
                            <Icon name="how_to_reg" size={20} />
                            <span>{user?.['姓名'] || user?.Name || '工作人員'}</span>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={loadData} className="flex items-center gap-1 bg-white/10 px-3 py-1.5 rounded-xl text-xs font-bold hover:bg-white/20 transition-all">
                                <Icon name="sync" size={14} className={isSyncing ? "animate-spin" : ""} />
                                更新
                            </button>
                            <button onClick={() => setView('lookup')} className="bg-white/10 px-3 py-1.5 rounded-xl text-xs font-bold">登出</button>
                        </div>
                    </div>

                    <div className="bg-slate-800/50 rounded-3xl p-4 mb-4 grid grid-cols-2 gap-3 text-left border border-white/5 shadow-2xl">
                        <div className="bg-slate-900/50 p-3 rounded-2xl border border-white/5">
                            <p className="text-[10px] font-black text-amber-500 uppercase mb-1 flex items-center gap-1"><Icon name="star" size={10}/> VIP 報到</p>
                            <p className="text-xl font-black">{stats.vIn} <span className="text-[10px] text-slate-500 font-bold">/ {stats.vTotal}</span></p>
                        </div>
                        <div className="bg-slate-900/50 p-3 rounded-2xl border border-white/5">
                            <p className="text-[10px] font-black text-blue-500 uppercase mb-1 flex items-center gap-1"><Icon name="group" size={10}/> 一般報到</p>
                            <p className="text-xl font-black">{stats.nIn} <span className="text-[10px] text-slate-500 font-bold">/ {stats.nTotal}</span></p>
                        </div>
                        <div className="bg-slate-900/50 p-3 rounded-2xl border border-white/5">
                            <p className="text-[10px] font-black text-emerald-500 uppercase mb-1 flex items-center gap-1"><Icon name="restaurant" size={10}/> 領餐</p>
                            <p className="text-xl font-black">{stats.mealClaimed} <span className="text-[10px] text-slate-500 font-bold">/ {stats.total}</span></p>
                        </div>
                        <div className="bg-slate-900/50 p-3 rounded-2xl border border-white/5">
                            <p className="text-[10px] font-black text-purple-500 uppercase mb-1 flex items-center gap-1"><Icon name="redeem" size={10}/> 領禮物</p>
                            <p className="text-xl font-black">{stats.giftClaimed} <span className="text-[10px] text-slate-500 font-bold">/ {stats.total}</span></p>
                        </div>
                    </div>

                    {!scanRes && (
                        <div className="flex bg-slate-800 p-1 rounded-xl mb-4 shadow-inner">
                            <button onClick={() => setScanMode('checkin')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${scanMode === 'checkin' ? 'bg-blue-600 text-white shadow-md' : 'text-slate-400'}`}>入場報到</button>
                            <button onClick={() => setScanMode('meal')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${scanMode === 'meal' ? 'bg-emerald-600 text-white shadow-md' : 'text-slate-400'}`}>發放餐點</button>
                            <button onClick={() => setScanMode('souvenir')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${scanMode === 'souvenir' ? 'bg-purple-600 text-white shadow-md' : 'text-slate-400'}`}>發放紀念品</button>
                        </div>
                    )}

                    {!scanRes ? (
                        <div className="flex flex-col items-center flex-1 justify-center">
                            <div className={`border-4 shadow-[0_0_20px_rgba(0,0,0,0.5)] rounded-[32px] overflow-hidden mb-4 ${scanMode === 'checkin' ? 'border-blue-500' : scanMode === 'meal' ? 'border-emerald-500' : 'border-purple-500'}`}>
                                <div id="reader" className="w-full max-w-[300px] aspect-square relative bg-white"></div>
                            </div>
                            
                            <div className="flex gap-2 w-full max-w-[300px]">
                                <input type="text" placeholder="手動輸入序號 ID" className="flex-1 bg-slate-800 border border-slate-700 text-white p-3 rounded-xl outline-none focus:border-orange-500 text-sm" value={manualId} onChange={e => setManualId(e.target.value)} onKeyPress={e => { if(e.key === 'Enter' && manualId.trim()) processCheckIn(manualId.trim()); }} />
                                <button onClick={() => { if(manualId.trim()) processCheckIn(manualId.trim()); }} className="bg-orange-600 hover:bg-orange-500 text-white px-5 rounded-xl font-bold text-sm transition shadow-lg">送出</button>
                            </div>
                        </div>
                    ) : (
                        <div className="bg-slate-800 p-8 rounded-[48px] shadow-2xl text-left border border-slate-700 mt-4 text-center">
                            <div className="mb-4">
                                {isSyncing ? <Icon name="sync" className="animate-spin text-slate-400" size={40} /> : 
                                 scanRes.status === 'success' ? <Icon name="check_circle" className="text-green-400" size={40} /> : 
                                 scanRes.status === 'warning' ? <Icon name="warning" className="text-yellow-400" size={40} /> : 
                                 <Icon name="cancel" className="text-red-400" size={40} />}
                            </div>
                            <h3 className="text-2xl font-black mb-1 text-white">{scanRes.Name || scanRes['姓名']}</h3>
                            <p className="text-xs font-bold text-slate-400 mb-6">{scanRes.Company || scanRes['公司']}</p>
                            
                            <div className="mb-8 text-sm font-bold h-8 flex items-center justify-center">
                                {isSyncing && <span className="text-slate-400">寫入資料庫中...</span>}
                                {scanRes.status === 'success' && <span className="text-green-400">{scanRes.msg}</span>}
                                {scanRes.status === 'warning' && <span className="text-yellow-400">{scanRes.msg}</span>}
                                {(scanRes.status === 'error' || scanRes.status === 'not_found') && <span className="text-red-400">{scanRes.msg}</span>}
                            </div>
                            
                            <button onClick={() => {setScanRes(null); setManualId('');}} disabled={isSyncing} className={`w-full py-4 rounded-2xl font-bold uppercase tracking-widest ${isSyncing ? 'bg-slate-700 text-slate-500' : 'bg-orange-600 text-white'}`}>繼續掃描</button>
                        </div>
                    )}
                </div>
            );
        }

        const root = window.ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
