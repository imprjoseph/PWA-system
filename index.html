<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>IMPR - ç®¡ç†èˆ‡å ±åˆ°ç³»çµ±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://unpkg.com/lucide-react/dist/umd/lucide-react.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
    .animate-fade-in { animation: fade-in 0.5s ease-out; }
    body { background-color: #0f172a; margin: 0; font-family: sans-serif; }
    #reader { width: 100% !important; max-width: 320px; margin: 0 auto; border: none !important; border-radius: 1rem; overflow: hidden; }
    #reader__scan_region { background: white; }
  </style>
</head>
<body>
  <div id="root">ç³»çµ±åˆå§‹åŒ–ä¸­...</div>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef } = React;

    const Icon = ({ name, ...props }) => {
      const LucideIcon = window.LucideReact ? window.LucideReact[name] : null;
      return LucideIcon ? <LucideIcon {...props} /> : null;
    };

    const translations = {
      zh: {
        sysTitle: "æ´»å‹•å ±åˆ°ç³»çµ±",
        sysSubTitle: "Event Check-in System",
        loginPlaceholder: "è«‹è¼¸å…¥ Email / æ‰‹æ©Ÿè™Ÿç¢¼ / ID",
        loginBtn: "ç™»å…¥æŸ¥è©¢",
        staffEntry: "å·¥ä½œäººå“¡å…¥å£",
        notFound: "æŸ¥ç„¡è³‡æ–™ï¼Œè«‹ç¢ºèªè¼¸å…¥æ˜¯å¦æœ‰èª¤ã€‚",
        back: "å›é¦–é ",
        refresh: "æ›´æ–°è³‡æ–™",
        qrTitle: "å°ˆå±¬å ±åˆ°æ†‘è­‰",
        infoTitle: "åŸºæœ¬è³‡è¨Š",
        serialId: "åºè™Ÿ ID",
        company: "æ‰€å±¬å…¬å¸",
        email: "è¯çµ¡ä¿¡ç®±",
        dietary: "é¤é»éœ€æ±‚",
        none: "ç„¡ç‰¹åˆ¥å‚™è¨»",
        statusTitle: "é ˜å–ç‹€æ…‹",
        mealClaimed: "é¤é»å·²é ˜å–",
        mealUnclaimed: "é¤é»æœªé ˜å–",
        souvenirClaimed: "ç´€å¿µå“å·²é ˜",
        souvenirUnclaimed: "ç´€å¿µå“æœªé ˜",
        manualInput: "æ‰‹å‹•è¼¸å…¥åºè™Ÿ ID", // æ–°å¢
        manualSubmit: "é€å‡º" // æ–°å¢
      },
      en: {
        sysTitle: "Event Check-in System",
        sysSubTitle: "",
        loginPlaceholder: "Enter Email / Phone / ID",
        loginBtn: "Login",
        staffEntry: "Staff Login",
        notFound: "Data not found. Please check your input.",
        back: "Back",
        refresh: "Refresh",
        qrTitle: "ENTRY QR CODE",
        infoTitle: "Basic Info",
        serialId: "Serial ID",
        company: "Company",
        email: "Email",
        dietary: "Dietary",
        none: "None",
        statusTitle: "Status",
        mealClaimed: "Meal Claimed",
        mealUnclaimed: "Unclaimed",
        souvenirClaimed: "Gift Claimed",
        souvenirUnclaimed: "Unclaimed",
        manualInput: "Manual Enter ID", // æ–°å¢
        manualSubmit: "Submit" // æ–°å¢
      }
    };

    function App() {
      const [db, setDb] = useState({ LIST: [], WORKER: [] });
      const [view, setView] = useState('lookup'); 
      const [user, setUser] = useState(null);
      const [input, setInput] = useState('');
      const [staffAccount, setStaffAccount] = useState('');
      const [staffPassword, setStaffPassword] = useState('');
      const [loggedStaff, setLoggedStaff] = useState(null);
      const [scanResult, setScanResult] = useState(null);
      const [isSyncing, setIsSyncing] = useState(false);
      const [scanMode, setScanMode] = useState('checkin');
      const [lang, setLang] = useState('zh');
      
      // ğŸŒŸ æ–°å¢ï¼šæ‰‹å‹•è¼¸å…¥ ID ç‹€æ…‹
      const [manualId, setManualId] = useState('');
      
      const t = translations[lang];
      const API = "https://script.google.com/macros/s/AKfycbwALn6OxDxqEP3LEmUB5oUuYnXHA-VxHhCLMHwhz5rzGP1p4RUrmi5HoWjF0S8kPf8m/exec";

      const dbRef = useRef(db);
      useEffect(() => { dbRef.current = db; }, [db]);

      const loadData = () => {
        setIsSyncing(true);
        fetch(API).then(res => res.json()).then(data => {
          setDb(data);
          if(user) {
            const updatedUser = data.LIST.find(a => String(a.ID) === String(user.ID));
            if(updatedUser) setUser(updatedUser);
          }
          setIsSyncing(false);
        }).catch(() => setIsSyncing(false));
      };

      useEffect(() => { loadData(); }, []);

      const stats = useMemo(() => {
        let vTotal = 0, vIn = 0, nTotal = 0, nIn = 0;
        let mealClaimed = 0, souvenirClaimed = 0;
        db.LIST?.forEach(row => {
          const lv = String(row.Level || row['ç­‰ç´š'] || '').toUpperCase();
          if (lv === 'VIP') { vTotal++; if (row['å ±åˆ°æ™‚é–“']) vIn++; }
          else { nTotal++; if (row['å ±åˆ°æ™‚é–“']) nIn++; }
          if (row['é ˜é¤æ™‚é–“']) mealClaimed++;
          if (row['ç´€å¿µå“é ˜å–æ™‚é–“']) souvenirClaimed++;
        });
        return { vTotal, vIn, nTotal, nIn, mealClaimed, souvenirClaimed, totalPeople: vTotal + nTotal };
      }, [db.LIST]);

      // ğŸŒŸ æ ¸å¿ƒè™•ç†é‚è¼¯æå– (ä¾›ç›¸æ©Ÿèˆ‡æ‰‹å‹•è¼¸å…¥å…±ç”¨)
      const processCheckIn = (idText) => {
        const currentDb = dbRef.current;
        const found = currentDb.LIST?.find(a => String(a.ID) === idText);
        
        if (found) {
          setScanResult({ ...found, status: 'found' });
          setIsSyncing(true);
          fetch(API, { method: 'POST', body: JSON.stringify({ id: idText, action: scanMode }) })
          .then(res => res.json())
          .then(result => {
            setIsSyncing(false);
            if(result.status === "success") {
              setScanResult({ ...found, status: 'success', successMsg: result.message });
              loadData(); 
            } else if (result.status === "warning") {
              setScanResult({ ...found, status: 'warning', errorMsg: result.message });
            } else {
              setScanResult({ ...found, status: 'error', errorMsg: 'å¯«å…¥å¤±æ•—' });
            }
          }).catch(() => {
            setIsSyncing(false);
            setScanResult({ ...found, status: 'error', errorMsg: 'ç¶²è·¯é€£ç·šç•°å¸¸' });
          });
        } else {
          setScanResult({ Name: "æœªçŸ¥ä»£ç¢¼ / Unknown ID", ID: idText, status: 'not_found' });
        }
      };

      // ç›¸æ©Ÿæ§åˆ¶
      useEffect(() => {
        let html5QrCode;
        if (view === 'scanner' && !scanResult) {
          html5QrCode = new Html5Qrcode("reader");
          html5QrCode.start(
            { facingMode: "environment" },
            { fps: 10, qrbox: { width: 250, height: 250 } },
            (decodedText) => {
              if (html5QrCode.isScanning) {
                // ç›¸æ©Ÿæƒåˆ°å¾Œç«‹åˆ»é—œé–‰ï¼Œè½‰äº¤çµ¦æ ¸å¿ƒè™•ç†
                html5QrCode.stop().then(() => { processCheckIn(decodedText); }).catch(err => console.error(err));
              }
            }, 
            () => {} 
          ).catch(err => console.error("ç›¸æ©Ÿå•Ÿå‹•å¤±æ•—", err));
        }

        return () => { 
          if(html5QrCode && html5QrCode.isScanning) {
            html5QrCode.stop().catch(err => console.error(err)); 
          }
        };
      }, [view, scanMode, scanResult]);

      // --- ç•«é¢ä¸€ï¼šå·¥ä½œäººå“¡ç™»å…¥ ---
      if (view === 'staffLogin') {
        return (
          <div className="min-h-screen bg-slate-900 flex items-center justify-center p-6 animate-fade-in">
            <div className="max-w-md w-full bg-slate-800 p-8 rounded-[30px] shadow-2xl border border-slate-700">
              <div className="flex justify-between items-center mb-6">
                <button onClick={() => setView('lookup')} className="text-slate-400 hover:text-white flex items-center gap-1"><Icon name="ArrowLeft" size={18}/> è¿”å›</button>
                <div className="px-3 py-1 bg-slate-700 text-slate-300 rounded-full text-xs font-bold tracking-widest flex items-center gap-1"><Icon name="Lock" size={12}/> STAFF</div>
              </div>
              <h2 className="text-2xl font-bold text-white mb-6 text-center">å¾Œå°ç®¡ç†ç™»å…¥</h2>
              <input type="text" placeholder="å¸³è™Ÿ Account" className="w-full p-4 mb-4 bg-slate-900 text-white border border-slate-700 rounded-xl outline-none focus:border-orange-500" value={staffAccount} onChange={e => setStaffAccount(e.target.value)} />
              <input type="password" placeholder="å¯†ç¢¼ Password" className="w-full p-4 mb-6 bg-slate-900 text-white border border-slate-700 rounded-xl outline-none focus:border-orange-500" value={staffPassword} onChange={e => setStaffPassword(e.target.value)} />
              <button onClick={() => {
                const foundStaff = db.WORKER?.find(w => String(w['å¸³è™Ÿ']) === staffAccount && String(w['å¯†ç¢¼']) === staffPassword);
                if(foundStaff) { setLoggedStaff(foundStaff); setView('scanner'); setStaffAccount(''); setStaffPassword(''); } 
                else { alert("å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ï¼\nInvalid account or password."); }
              }} className="w-full bg-orange-600 text-white p-4 rounded-xl font-bold hover:bg-orange-500">ç™»å…¥ Login</button>
            </div>
          </div>
        );
      }

      // --- ç•«é¢äºŒï¼šå·¥ä½œäººå“¡æƒæä»‹é¢ ---
      if (view === 'scanner') {
        return (
          <div className="min-h-screen bg-slate-900 text-white p-4 animate-fade-in pb-10">
            <div className="flex justify-between items-center mb-4 mt-2">
              <h1 className="text-lg font-bold flex items-center gap-2 text-orange-400"><Icon name="Scan" size={20} /> ç®¡ç†å“¡: {loggedStaff?.['å§“å'] || 'æœªå‘½å'}</h1>
              <div className="flex gap-2">
                <button onClick={loadData} className="text-slate-400 border border-slate-700 px-3 py-1 rounded-lg text-sm flex items-center gap-1 hover:bg-slate-800"><Icon name="RefreshCw" size={14} className={isSyncing ? "animate-spin" : ""} /> æ›´æ–°</button>
                <button onClick={() => {setView('lookup'); setScanResult(null); setLoggedStaff(null);}} className="text-slate-400 border border-slate-700 px-3 py-1 rounded-lg text-sm flex items-center gap-1 hover:bg-slate-800"><Icon name="LogOut" size={14} /> ç™»å‡º</button>
              </div>
            </div>

            <div className="bg-slate-800 rounded-2xl p-4 mb-4 grid grid-cols-2 gap-4 text-sm shadow-lg border border-slate-700">
              <div className="bg-slate-900 p-3 rounded-xl border border-slate-700"><p className="text-slate-400 mb-1 flex items-center gap-1"><Icon name="Star" size={14} className="text-amber-400"/> VIP å ±åˆ°</p><p className="text-xl font-bold">{stats.vIn} <span className="text-xs text-slate-500">/ {stats.vTotal}</span></p></div>
              <div className="bg-slate-900 p-3 rounded-xl border border-slate-700"><p className="text-slate-400 mb-1 flex items-center gap-1"><Icon name="User" size={14} className="text-blue-400"/> ä¸€èˆ¬å ±åˆ°</p><p className="text-xl font-bold">{stats.nIn} <span className="text-xs text-slate-500">/ {stats.nTotal}</span></p></div>
              <div className="bg-slate-900 p-3 rounded-xl border border-slate-700"><p className="text-slate-400 mb-1 flex items-center gap-1"><Icon name="Utensils" size={14} className="text-emerald-400"/> ç™¼æ”¾é¤é»</p><p className="text-xl font-bold">{stats.mealClaimed} <span className="text-xs text-slate-500">/ {stats.totalPeople}</span></p></div>
              <div className="bg-slate-900 p-3 rounded-xl border border-slate-700"><p className="text-slate-400 mb-1 flex items-center gap-1"><Icon name="Gift" size={14} className="text-purple-400"/> ç™¼æ”¾ç´€å¿µå“</p><p className="text-xl font-bold">{stats.souvenirClaimed} <span className="text-xs text-slate-500">/ {stats.totalPeople}</span></p></div>
            </div>

            {!scanResult && (
              <div className="flex bg-slate-800 p-1 rounded-xl mb-4 shadow-inner">
                <button onClick={() => setScanMode('checkin')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${scanMode === 'checkin' ? 'bg-blue-600 text-white shadow-md' : 'text-slate-400'}`}>å…¥å ´å ±åˆ°</button>
                <button onClick={() => setScanMode('meal')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${scanMode === 'meal' ? 'bg-emerald-600 text-white shadow-md' : 'text-slate-400'}`}>ç™¼æ”¾é¤é»</button>
                <button onClick={() => setScanMode('souvenir')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${scanMode === 'souvenir' ? 'bg-purple-600 text-white shadow-md' : 'text-slate-400'}`}>ç™¼æ”¾ç´€å¿µå“</button>
              </div>
            )}
            
            {!scanResult ? (
              <div className="max-w-[320px] mx-auto animate-fade-in">
                {/* æƒæå™¨å¤–æ¡† */}
                <div className={`border-4 shadow-[0_0_20px_rgba(0,0,0,0.5)] rounded-2xl overflow-hidden mb-4 ${scanMode === 'checkin' ? 'border-blue-500' : scanMode === 'meal' ? 'border-emerald-500' : 'border-purple-500'}`}>
                  <div id="reader"></div>
                </div>

                {/* ğŸŒŸ æ–°å¢ï¼šæ‰‹å‹•è¼¸å…¥å€å¡Š */}
                <div className="flex gap-2">
                  <input 
                    type="text" 
                    placeholder={t.manualInput} 
                    className="flex-1 bg-slate-800 border border-slate-700 text-white p-3 rounded-xl outline-none focus:border-orange-500 text-sm"
                    value={manualId} 
                    onChange={e => setManualId(e.target.value)}
                    onKeyPress={e => { if(e.key === 'Enter' && manualId.trim()) processCheckIn(manualId.trim()); }}
                  />
                  <button 
                    onClick={() => { if(manualId.trim()) processCheckIn(manualId.trim()); }} 
                    className="bg-orange-600 hover:bg-orange-500 text-white px-5 rounded-xl font-bold text-sm transition shadow-lg"
                  >
                    {t.manualSubmit}
                  </button>
                </div>
              </div>
            ) : (
              <div className="bg-slate-800 text-white p-8 rounded-3xl text-center border border-slate-700 mt-4">
                <div className={`w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center ${scanResult.status === 'success' ? 'bg-green-900 text-green-400' : scanResult.status === 'warning' ? 'bg-yellow-900 text-yellow-400' : 'bg-red-900 text-red-400'}`}>
                  {isSyncing ? <Icon name="Loader2" className="animate-spin" size={32} /> : scanResult.status === 'success' ? <Icon name="CheckCircle" size={32} /> : scanResult.status === 'warning' ? <Icon name="AlertTriangle" size={32} /> : <Icon name="XCircle" size={32} />}
                </div>
                <h2 className="text-2xl font-bold mb-1">{scanResult.Name}</h2>
                <div className="flex items-center justify-center gap-2 mb-4">
                  <span className={`px-2 py-0.5 rounded-md text-xs font-bold ${String(scanResult.Level).toUpperCase() === 'VIP' ? 'bg-amber-900 text-amber-400' : 'bg-blue-900 text-blue-400'}`}>{scanResult.Level || 'NORMAL'}</span>
                  <span className="text-slate-400">{scanResult.Company || "ç„¡å…¬å¸è³‡æ–™"}</span>
                </div>
                <div className="mb-6 h-6">
                  {isSyncing && <span className="text-slate-400 font-bold text-sm">å¯«å…¥ä¸­...</span>}
                  {scanResult.status === 'success' && <span className="text-green-400 font-bold text-sm">{scanResult.successMsg}</span>}
                  {scanResult.status === 'warning' && <span className="text-yellow-400 font-bold text-sm">{scanResult.errorMsg}</span>}
                  {scanResult.status === 'error' && <span className="text-red-400 font-bold text-sm">{scanResult.errorMsg}</span>}
                  {scanResult.status === 'not_found' && <span className="text-red-400 font-bold text-sm">æŸ¥ç„¡æ­¤äºº</span>}
                </div>
                {/* é»æ“Šç¹¼çºŒæƒææ™‚ï¼ŒåŒæ™‚æ¸…ç©ºæ‰‹å‹•è¼¸å…¥æ¡† */}
                <button onClick={() => {setScanResult(null); setManualId('');}} disabled={isSyncing} className={`w-full p-4 rounded-xl font-bold ${isSyncing ? 'bg-slate-700 text-slate-500' : 'bg-orange-600 text-white hover:bg-orange-500'}`}>ç¹¼çºŒä½œæ¥­</button>
              </div>
            )}
          </div>
        );
      }

      // --- ç•«é¢ä¸‰ï¼šèˆ‡æœƒè€…å€‹äººé é¢ ---
      if (view === 'dashboard' && user) {
        const isVip = String(user.Level || user['ç­‰ç´š'] || '').toUpperCase() === 'VIP';
        const themeBg = isVip ? 'bg-gradient-to-br from-amber-500 to-yellow-600' : 'bg-gradient-to-br from-blue-600 to-indigo-700';
        const badgeBg = isVip ? 'bg-amber-100 text-amber-700 border-amber-200' : 'bg-blue-100 text-blue-700 border-blue-200';
        
        return (
          <div className="min-h-screen bg-slate-50 flex flex-col animate-fade-in pb-10">
            <div className={`p-6 pt-8 ${themeBg} text-white rounded-b-[40px] shadow-lg relative z-10`}>
              <div className="flex justify-between items-center mb-4">
                <button onClick={() => {setUser(null); setView('lookup'); setInput('');}} className="flex items-center gap-1 font-medium hover:text-slate-200 transition"><Icon name="ArrowLeft" size={20} /> {t.back}</button>
                <div className="flex items-center gap-2">
                  <button onClick={() => setLang(lang === 'zh' ? 'en' : 'zh')} className="bg-white/20 hover:bg-white/30 px-2 py-1 rounded-md text-xs font-bold transition">
                    {lang === 'zh' ? 'EN' : 'ä¸­æ–‡'}
                  </button>
                  <button onClick={loadData} className="flex items-center gap-1 font-medium hover:text-slate-200 transition"><Icon name="RefreshCw" size={18} className={isSyncing ? "animate-spin" : ""} /> {t.refresh}</button>
                </div>
              </div>
              <div className="flex items-center gap-2 mb-1">
                <h2 className="text-3xl font-black">{user.Name}</h2>
                <div className="flex items-center gap-1 font-bold tracking-widest bg-white/20 px-2 py-0.5 rounded-md text-xs">{isVip && <Icon name="Star" size={12} className="fill-white" />} {isVip ? 'VIP' : 'GUEST'}</div>
              </div>
              <p className="opacity-90 font-medium text-lg">{user.Title || user['è·ç¨±']}</p>
            </div>

            <div className="px-5 -mt-6 relative z-20 flex flex-col items-center">
              <div className="w-full bg-white p-6 shadow-xl rounded-[30px] border border-slate-100 flex flex-col items-center mb-5">
                <div className="p-3 bg-slate-50 rounded-2xl mb-2 border border-slate-100">
                  <img src={`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${user.ID}`} className="w-40 h-40" alt="QR Code" />
                </div>
                <p className="font-bold text-slate-400 tracking-widest text-[10px] uppercase">{t.qrTitle}</p>
              </div>

              <div className="w-full bg-white p-6 shadow-xl rounded-[30px] border border-slate-100">
                <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2"><Icon name="FileText" className="text-slate-400" size={20} /> {t.infoTitle}</h3>
                
                <div className="space-y-3 text-sm mb-6">
                  <div className="flex items-start border-b border-slate-100 pb-2">
                    <span className="text-slate-500 mr-2 shrink-0 w-[4.5rem]">{t.serialId}:</span>
                    <span className="font-bold text-slate-800 flex-1">{user.ID || '-'}</span>
                  </div>
                  <div className="flex items-start border-b border-slate-100 pb-2">
                    <span className="text-slate-500 mr-2 shrink-0 w-[4.5rem]">{t.company}:</span>
                    <span className="font-bold text-slate-800 flex-1">{user.Company || user['å…¬å¸'] || '-'}</span>
                  </div>
                  <div className="flex items-start border-b border-slate-100 pb-2">
                    <span className="text-slate-500 mr-2 shrink-0 w-[4.5rem]">{t.email}:</span>
                    <span className="font-bold text-slate-800 break-all">{user.Email || '-'}</span>
                  </div>
                  <div className="flex items-center border-b border-slate-100 pb-2">
                    <span className="text-slate-500 mr-2 shrink-0 w-[4.5rem]">{t.dietary}:</span>
                    <span className={`font-bold border px-2 py-0.5 rounded-md ${badgeBg}`}>{user.Eating || user['é¤é»'] || t.none}</span>
                  </div>
                </div>

                <h3 className="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2"><Icon name="CheckCircle" className="text-slate-400" size={20} /> {t.statusTitle}</h3>
                <div className="grid grid-cols-2 gap-3">
                  <div className={`p-3 rounded-xl border flex flex-col items-center justify-center text-center ${user['é ˜é¤æ™‚é–“'] ? 'bg-emerald-50 border-emerald-200' : 'bg-slate-50 border-slate-200'}`}>
                    <Icon name="Utensils" size={24} className={`mb-1 ${user['é ˜é¤æ™‚é–“'] ? 'text-emerald-500' : 'text-slate-300'}`} />
                    <span className={`font-bold text-sm ${user['é ˜é¤æ™‚é–“'] ? 'text-emerald-700' : 'text-slate-500'}`}>{user['é ˜é¤æ™‚é–“'] ? t.mealClaimed : t.mealUnclaimed}</span>
                  </div>
                  <div className={`p-3 rounded-xl border flex flex-col items-center justify-center text-center ${user['ç´€å¿µå“é ˜å–æ™‚é–“'] ? 'bg-purple-50 border-purple-200' : 'bg-slate-50 border-slate-200'}`}>
                    <Icon name="Gift" size={24} className={`mb-1 ${user['ç´€å¿µå“é ˜å–æ™‚é–“'] ? 'text-purple-500' : 'text-slate-300'}`} />
                    <span className={`font-bold text-sm ${user['ç´€å¿µå“é ˜å–æ™‚é–“'] ? 'text-purple-700' : 'text-slate-500'}`}>{user['ç´€å¿µå“é ˜å–æ™‚é–“'] ? t.souvenirClaimed : t.souvenirUnclaimed}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // --- ç•«é¢å››ï¼šèˆ‡æœƒè€…ç™»å…¥é¦–é  ---
      return (
        <div className="min-h-screen bg-slate-50 flex items-center justify-center p-6 relative">
          
          <div className="absolute top-6 right-6">
            <button onClick={() => setLang(lang === 'zh' ? 'en' : 'zh')} className="bg-white border border-slate-200 text-slate-500 hover:text-orange-500 hover:border-orange-500 shadow-sm px-3 py-1.5 rounded-full text-xs font-bold transition flex items-center gap-1">
              <Icon name="Globe" size={14} /> {lang === 'zh' ? 'EN' : 'ä¸­æ–‡'}
            </button>
          </div>

          <div className="max-w-md w-full bg-white p-10 rounded-[40px] shadow-2xl animate-fade-in mt-8">
            <div className="flex justify-center mb-6">
               <img src="https://imprjoseph.github.io/PWA-system/logo.png" alt="æ–°å‹•åŠ›å…¬é—œ" className="h-16 w-auto object-contain" onError={(e) => { e.target.style.display='none'; document.getElementById('logo-fallback').style.display='block'; }}/>
               <div id="logo-fallback" className="hidden text-2xl font-black text-orange-600">IMPR æ–°å‹•åŠ›å…¬é—œ</div>
            </div>
            
            <h1 className="text-xl font-bold text-center mb-8 text-slate-600">
              {t.sysTitle}
              {t.sysSubTitle && <><br/><span className="text-sm font-normal text-slate-400">{t.sysSubTitle}</span></>}
            </h1>
            
            <input type="text" placeholder={t.loginPlaceholder} className="w-full p-4 mb-4 bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:ring-2 focus:ring-[#f37021]" value={input} onChange={e => setInput(e.target.value)} />
            
            <button onClick={() => {
              const found = db.LIST?.find(a => String(a.Email) === input || String(a.Phone) === input || String(a.ID) === input);
              if(found) { setUser(found); setView('dashboard'); } else { alert(t.notFound); }
            }} className="w-full bg-[#f37021] text-white p-4 rounded-2xl font-bold mb-4 shadow-lg shadow-orange-200 hover:bg-[#e06117] transition">{t.loginBtn}</button>
            
            <button onClick={() => setView('staffLogin')} className="w-full border-2 border-slate-100 text-slate-400 p-4 rounded-2xl font-bold flex items-center justify-center gap-2 mt-4 hover:bg-slate-50 transition">
              <Icon name="Lock" size={16} /> {t.staffEntry}
            </button>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
